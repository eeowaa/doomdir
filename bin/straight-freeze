#!/bin/sh
lockfile=`git rev-parse --show-toplevel`/packages.lock
[ -d "$DOOMDIR" ] || {
    [ -d "$XDG_CONFIG_HOME" ] || XDG_CONFIG_HOME=$HOME/.config
    DOOMDIR=$XDG_CONFIG_HOME/emacs
}
[ -d "$DOOMDIR/.local/straight/repos" ] || {
    echo >&2 "Directory does not exist: $DOOMDIR/.local/straight/repos"
    exit 1
}
cd "$DOOMDIR/.local/straight/repos"
for repo in *; do
    printf '\n ("%s" . "%s")' "$repo" "`git -C $repo rev-parse HEAD`"
done | sed -e '1d' -e '2s/^ /(/' -e '$s/$/)/' >"$lockfile"
echo >>"$lockfile"
